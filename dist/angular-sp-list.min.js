!function(){"use strict";angular.module("angular.sp.list",["angular.sp.digest"])}(),function(t){"use strict";t.module("angular.sp.list").factory("modelBuilderService",["_",function(e){function i(t,i,s){var o={};return Object.keys(i).forEach(function(t,r){var n=s["ows_"+t];i[t]&&n&&("Lookup"==n.objectType||"MultiChoice"==n.objectType||"LookupMulti"==n.objectType||"UserMulti"==n.objectType?i[t].results?o[n.mappedName]=i[t].results:"MultiChoice"==n.objectType?o[n.mappedName]=e.filter(i[t].split(";#"),function(t){return""!==t}):o[n.mappedName]=i[t]:o[n.mappedName]=i[t])}),new t(o,"rest")}function s(t,e,i){return new t($(e).SPXmlToJson({mapping:i,includeAllAttrs:!1,removeOws:!0}),"caml")}function o(i,s){var o=t.copy(i);return Object.keys(o).forEach(function(t,i){var r=e.findWhere(s,{mappedName:t});if(r&&!r.objectFactory){var n=e.findKey(s,r);n=n.substring(4,n.length),o[n]=o[t]}delete o[t]}),o}return{buildFromRestResponse:i,buildFromCamlResponse:s,convertToSharePointListItem:o}}])}(angular),function(t){"use strict";t.module("angular.sp.list").factory("restQueryBuilderService",["_",function(t){function e(e,i){var s=[];return Object.keys(e).forEach(function(o,r){var n=e[o],a=o.replace("ows_","");if("Lookup"==n.objectType||"LookupMulti"==n.objectType){if(i){var p=[];n.objectFactory&&n.objectFactory.prototype.getSelectFields&&(p=n.objectFactory.prototype.getSelectFields(!1).split(","),t.each(p,function(t,e){p[e]=a+"/"+t})),s=s.concat(p)}}else s.push(a)}),s.join(",")}function i(i,s){var o=[],r=e(i,!0).split(",");return r=t.filter(r,function(t,e){return-1!=t.indexOf("/")}),t.each(r,function(t,e){t=t.split("/"),t.pop(),t=t.join("/"),-1==o.indexOf(t)&&o.push(t)}),o.join(",")}return{getSelectFields:e,getExpandFields:i}}])}(angular),function(t){"use strict";t.module("angular.sp.list").factory("spListItem",["modelBuilderService","restQueryBuilderService",function(t,e){function i(i,s,o,r){this.siteUrl=i,this.listName=s,this.viewFields=o,this.spServicesJsonMapping=r,this.getListItemType=function(){return"SP.Data."+this.listName.charAt(0).toUpperCase()+this.listName.split(" ").join("").slice(1)+"ListItem"},this.getSelectFields=function(t){return e.getSelectFields(this.spServicesJsonMapping,t)},this.getExpandFields=function(t){return e.getExpandFields(this.spServicesJsonMapping,t)},this.buildFromJson=function(e,i){return t.buildFromRestResponse(e,i,this.spServicesJsonMapping)},this.buildFromXml=function(e,i){return t.buildFromCamlResponse(e,i,this.spServicesJsonMapping)},this.buildListItem=function(e){return t.convertToSharePointListItem(e,this.spServicesJsonMapping)},this.build=function(t,e){return $.isXMLDoc(e)?this.buildFromXml(t,e):this.buildFromJson(t,e)}}return i}])}(angular),function(t){"use strict";t.module("angular.sp.list").factory("spListService",["$http","$q","_","RequestDigestIntervalService","RequestDigestCacheService",function(e,i,s,o,r){function n(i){this.spListItem=i,o.start(i.prototype.siteUrl),this.getByFilter=function(e,i){var s={$filter:e};return i=t.extend({},i,s),this.executeRestQuery(i)},this.getByFilters=this.getByFilter,this.get=function(t){return this.executeRestQuery(t)},this.getById=function(t){return this.getByArrayOfIds([t])},this.getByArrayOfIds=function(t){var e=[];s.each(t,function(t){e.push("<Value Type='Text'>"+t+"</Value>")});var i="<Query><Where><In><FieldRef Name='ID'/><Values>"+e.join("")+"</Values></In></Where></Query>";return this.executeCamlQuery(i)},this.create=function(s){s=new i(s);var o={accept:"application/json;odata=verbose","X-RequestDigest":r.get(i.prototype.siteUrl),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"POST"},n=i.prototype.getListItemType(),a={__metadata:{type:n}};a=t.extend({},s,a);var p=i.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+i.prototype.listName+"')/Items",c=JSON.stringify(a);return e({method:"POST",url:p,contentType:"application/json;odata=verbose",data:c,headers:o}).then(function(t){return t.data.d})},this.update=function(s){s=new i(s);var o={accept:"application/json;odata=verbose","X-RequestDigest":r.get(i.prototype.siteUrl),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"MERGE"},n=i.prototype.getListItemType(),a={__metadata:{type:n}};a=t.extend({},s,a);var p=i.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+i.prototype.listName+"')/Items("+s.Id+")",c=JSON.stringify(a);return e({method:"POST",url:p,contentType:"application/json;odata=verbose",data:c,headers:o})},this.remove=function(s){s=new i(s);var o={accept:"application/json;odata=verbose","X-RequestDigest":r.get(i.prototype.siteUrl),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"DELETE"},n=i.prototype.getListItemType(),a={__metadata:{type:n}};a=t.extend({},s,a);var p=i.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+i.prototype.listName+"')/Items("+s.Id+")",c=JSON.stringify(a);return e({method:"POST",url:p,contentType:"application/json;odata=verbose",data:c,headers:o})},this.getCount=function(s){var o=i.prototype.siteUrl+"/_vti_bin/listdata.svc/"+i.prototype.listName+"/$count";return e({method:"GET",url:o,headers:{accept:"application/json;odata=verbose","content-Type":"application/json;odata=verbose"},params:{$filter:s}}).then(function(e){var i=0;try{t.isFinite(e.data)&&(i=e.data)}catch(t){}return i})},this.executeCamlQuery=function(t){var s=i.prototype.siteUrl+"/_vti_bin/Lists.asmx";return e({method:"POST",url:s,headers:{"Content-Type":"text/xml;charset='utf-8'",Accept:"application/json",SOAPAction:"http://schemas.microsoft.com/sharepoint/soap/GetListItems"},data:'<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+i.prototype.listName+"</listName><query>"+t+"</query></GetListItems></soap:Body></soap:Envelope>"}).then(function(t){var e=t.data.body||t.data,s=$.parseXML(e);return $(s).SPFilterNode("z:row").SPXmlToJson({mapping:i.prototype.spServicesJsonMapping,includeAllAttrs:!1})})},this.executeRestQuery=function(o){var r=i.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+i.prototype.listName+"')/Items",n=t.extend({},o);return e({method:"GET",url:r,headers:{accept:"application/json;odata=verbose","content-Type":"application/json;odata=verbose"},params:{$select:n.$select,$filter:n.$filter,$skip:n.$skip,$top:n.$top,$expand:n.$expand,$orderby:n.$orderby}}).then(function(t){var e=[];return t.data.d&&t.data.d.results&&s.each(t.data.d.results,function(t,s){e.push(i.prototype.buildFromJson(i,t))}),e})}}return n}])}(angular);