!function(){"use strict";angular.module("angular.sp.list",["angular.sp.digest"])}(),function(t){"use strict";t.module("angular.sp.list").factory("modelBuilderService",["_",function(e){function s(t,s,i){var o={};return Object.keys(s).forEach(function(t,r){var n=i["ows_"+t];s[t]&&n&&("MultiChoice"==n.objectType||"LookupMulti"==n.objectType||"UserMulti"==n.objectType?s[t].results?o[n.mappedName]=s[t].results:"MultiChoice"==n.objectType?o[n.mappedName]=e.filter(s[t].split(";#"),function(t){return""!==t}):o[n.mappedName]=s[t]:o[n.mappedName]=s[t])}),new t(o,"rest")}function i(t,e,s){return new t($(e).SPXmlToJson({mapping:s,includeAllAttrs:!1,removeOws:!0}),"caml")}function o(s,i){var o=t.copy(s);return Object.keys(o).forEach(function(t,s){var r=e.findWhere(i,{mappedName:t});if(r&&!r.objectFactory){var n=e.findKey(i,r);n=n.substring(4,n.length),o[n]=o[t]}delete o[t]}),o}return{buildFromRestResponse:s,buildFromCamlResponse:i,convertToSharePointListItem:o}}])}(angular),function(t){"use strict";t.module("angular.sp.list").factory("restQueryBuilderService",["_",function(t){function e(e,s){var i=[];return Object.keys(e).forEach(function(o,r){var n=e[o],a=o.replace("ows_","");if("Lookup"==n.objectType||"LookupMulti"==n.objectType){if(s){var p=[];n.objectFactory&&n.objectFactory.prototype.getSelectFields&&(p=n.objectFactory.prototype.getSelectFields(!1).split(","),t.each(p,function(t,e){p[e]=a+"/"+t})),i=i.concat(p)}}else i.push(a)}),i.join(",")}function s(s,i){var o=[],r=e(s,!0).split(",");return r=t.filter(r,function(t,e){return-1!=t.indexOf("/")}),t.each(r,function(t,e){t=t.split("/"),t.pop(),t=t.join("/"),-1==o.indexOf(t)&&o.push(t)}),o.join(",")}return{getSelectFields:e,getExpandFields:s}}])}(angular),function(t){"use strict";t.module("angular.sp.list").factory("spListItem",["modelBuilderService","restQueryBuilderService",function(t,e){function s(s,i,o,r){this.siteUrl=s,this.listName=i,this.viewFields=o,this.spServicesJsonMapping=r,this.getListItemType=function(){return"SP.Data."+this.listName.charAt(0).toUpperCase()+this.listName.split(" ").join("").slice(1)+"ListItem"},this.getSelectFields=function(t){return e.getSelectFields(this.spServicesJsonMapping,t)},this.getExpandFields=function(t){return e.getExpandFields(this.spServicesJsonMapping,t)},this.buildFromJson=function(e,s){return t.buildFromRestResponse(e,s,this.spServicesJsonMapping)},this.buildFromXml=function(e,s){return t.buildFromCamlResponse(e,s,this.spServicesJsonMapping)},this.buildListItem=function(e){return t.convertToSharePointListItem(e,this.spServicesJsonMapping)},this.build=function(t,e){return $.isXMLDoc(e)?this.buildFromXml(t,e):this.buildFromJson(t,e)}}return s}])}(angular),function(t){"use strict";t.module("angular.sp.list").factory("spListService",["$http","$q","_","RequestDigestIntervalService","RequestDigestCacheService",function(e,s,i,o,r){function n(s){this.spListItem=s,o.start(s.prototype.siteUrl),this.getByFilter=function(e,s){var i={$filter:e};return s=t.extend({},s,i),this.executeRestQuery(s)},this.getByFilters=this.getByFilter,this.get=function(t){return this.executeRestQuery(t)},this.getById=function(t){return this.getByArrayOfIds([t])},this.getByArrayOfIds=function(t){var e=[];i.each(t,function(t){e.push("<Value Type='Text'>"+t+"</Value>")});var s="<Query><Where><In><FieldRef Name='ID'/><Values>"+e.join("")+"</Values></In></Where></Query>";return this.executeCamlQuery(s)},this.create=function(i){i=new s(i);var o={accept:"application/json;odata=verbose","X-RequestDigest":r.get(s.prototype.siteUrl),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"POST"},n=s.prototype.getListItemType(),a={__metadata:{type:n}};a=t.extend({},i,a);var p=s.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+s.prototype.listName+"')/Items",c=JSON.stringify(a);return e({method:"POST",url:p,contentType:"application/json;odata=verbose",data:c,headers:o}).then(function(t){return t.data.d})},this.update=function(i){i=new s(i);var o={accept:"application/json;odata=verbose","X-RequestDigest":r.get(s.prototype.siteUrl),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"MERGE"},n=s.prototype.getListItemType(),a={__metadata:{type:n}};a=t.extend({},i,a);var p=s.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+s.prototype.listName+"')/Items("+i.Id+")",c=JSON.stringify(a);return e({method:"POST",url:p,contentType:"application/json;odata=verbose",data:c,headers:o})},this.remove=function(i){i=new s(i);var o={accept:"application/json;odata=verbose","X-RequestDigest":r.get(s.prototype.siteUrl),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"DELETE"},n=s.prototype.getListItemType(),a={__metadata:{type:n}};a=t.extend({},i,a);var p=s.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+s.prototype.listName+"')/Items("+i.Id+")",c=JSON.stringify(a);return e({method:"POST",url:p,contentType:"application/json;odata=verbose",data:c,headers:o})},this.executeCamlQuery=function(t){var i=s.prototype.siteUrl+"/_vti_bin/Lists.asmx";return e({method:"POST",url:i,headers:{"Content-Type":"text/xml;charset='utf-8'",Accept:"application/json",SOAPAction:"http://schemas.microsoft.com/sharepoint/soap/GetListItems"},data:'<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+s.prototype.listName+"</listName><query>"+t+"</query></GetListItems></soap:Body></soap:Envelope>"}).then(function(t){var e=t.data.body||t.data,i=$.parseXML(e);return $(i).SPFilterNode("z:row").SPXmlToJson({mapping:s.prototype.spServicesJsonMapping,includeAllAttrs:!1})})},this.executeRestQuery=function(o){var r=s.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+s.prototype.listName+"')/Items",n=t.extend({},o);return e({method:"GET",url:r,headers:{accept:"application/json;odata=verbose","content-Type":"application/json;odata=verbose"},params:{$select:n.$select,$filter:n.$filter,$skip:n.$skip,$top:n.$top,$expand:n.$expand,$orderby:parmas.$orderby}}).then(function(t){var e=[];return t.data.d&&t.data.d.results&&i.each(t.data.d.results,function(t,i){e.push(s.prototype.buildFromJson(s,t))}),e})}}return n}])}(angular);