!function(){"use strict";angular.module("angular.sp.list",["angular.sp.digest"])}(),function(e){"use strict";e.module("angular.sp.list").factory("modelBuilderService",["_",function(t){function o(e,o,a){var p={};return Object.keys(o).forEach(function(e,i){var s=a["ows_"+e];o[e]&&s&&("Lookup"==s.objectType||"MultiChoice"==s.objectType||"LookupMulti"==s.objectType||"UserMulti"==s.objectType?o[e].results?p[s.mappedName]=o[e].results:"MultiChoice"==s.objectType?p[s.mappedName]=t.filter(o[e].split(";#"),function(e){return""!==e}):p[s.mappedName]=o[e]:p[s.mappedName]=o[e])}),new e(p,"rest")}function a(e,t,o){return new e($(t).SPXmlToJson({mapping:o,includeAllAttrs:!1,removeOws:!0}),"caml")}function p(o,a){var p=e.copy(o);return Object.keys(p).forEach(function(e,o){var i=t.findWhere(a,{mappedName:e});if(i&&!i.objectFactory){var s=t.findKey(a,i);s=s.substring(4,s.length),p[s]=p[e]}delete p[e]}),p}return{buildFromRestResponse:o,buildFromCamlResponse:a,convertToSharePointListItem:p}}])}(angular),function(e){"use strict";e.module("angular.sp.list").factory("restQueryBuilderService",["_",function(e){function t(t,o){var a=[];return Object.keys(t).forEach(function(p,i){var s=t[p],n=p.replace("ows_","");if("Lookup"==s.objectType||"LookupMulti"==s.objectType){if(o){var r=[];s.objectFactory&&s.objectFactory.prototype.getSelectFields&&(r=s.objectFactory.prototype.getSelectFields(!1).split(","),e.each(r,function(e,t){r[t]=n+"/"+e})),a=a.concat(r)}}else a.push(n)}),a.join(",")}function o(o,a){var p=[],i=t(o,!0).split(",");return i=e.filter(i,function(e,t){return-1!=e.indexOf("/")}),e.each(i,function(e,t){e=e.split("/"),e.pop(),e=e.join("/"),-1==p.indexOf(e)&&p.push(e)}),p.join(",")}return{getSelectFields:t,getExpandFields:o}}])}(angular),function(e){"use strict";e.module("angular.sp.list").factory("spBuiltInFieldNames",[function(){return{ows_ID:{mappedName:"Id",objectType:"Number"},ows_ContentTypeId:{mappedName:"ContentTypeId",objectType:"ContentTypeId"},ows_ContentType:{mappedName:"ContentType",objectType:"Text"},ows_Created:{mappedName:"Created",objectType:"DateTime"},ows_Author:{mappedName:"Author",objectType:"User"},ows_Modified:{mappedName:"Modified",objectType:"DateTime"},ows_Editor:{mappedName:"Editor",objectType:"User"},ows__HasCopyDestinations:{mappedName:"_HasCopyDestinations",objectType:"Boolean"},ows__CopySource:{mappedName:"_CopySource",objectType:"Text"},ows__ModerationStatus:{mappedName:"_ModerationStatus",objectType:"ModStat"},ows__ModerationComments:{mappedName:"_ModerationComments",objectType:"Note"},ows_FileRef:{mappedName:"FileRef",objectType:"Lookup"},ows_FileDirRef:{mappedName:"FileDirRef",objectType:"Lookup"},ows_Last_x0020_Modified:{mappedName:"Last_x0020_Modified",objectType:"Lookup"},ows_Created_x0020_Date:{mappedName:"Created_x0020_Date",objectType:"Lookup"},ows_File_x0020_Size:{mappedName:"File_x0020_Size",objectType:"Lookup"},ows_FSObjType:{mappedName:"FSObjType",objectType:"Lookup"},ows_PermMask:{mappedName:"PermMask",objectType:"Computed"},ows_CheckedOutUserId:{mappedName:"CheckedOutUserId",objectType:"Lookup"},ows_IsCheckedoutToLocal:{mappedName:"IsCheckedoutToLocal",objectType:"Lookup"},ows_CheckoutUser:{mappedName:"CheckoutUser",objectType:"User"},ows_FileLeafRef:{mappedName:"FileLeafRef",objectType:"File"},ows_UniqueId:{mappedName:"UniqueId",objectType:"Lookup"},ows_ProgId:{mappedName:"ProgId",objectType:"Lookup"},ows_ScopeId:{mappedName:"ScopeId",objectType:"Lookup"},ows_VirusStatus:{mappedName:"VirusStatus",objectType:"Lookup"},ows_CheckedOutTitle:{mappedName:"CheckedOutTitle",objectType:"Lookup"},ows__CheckinComment:{mappedName:"_CheckinComment",objectType:"Lookup"},ows_LinkCheckedOutTitle:{mappedName:"LinkCheckedOutTitle",objectType:"Computed"},ows_Modified_x0020_By:{mappedName:"Modified_x0020_By",objectType:"Text"},ows_Created_x0020_By:{mappedName:"Created_x0020_By",objectType:"Text"},ows_File_x0020_Type:{mappedName:"File_x0020_Type",objectType:"Text"},ows_HTML_x0020_File_x0020_Type:{mappedName:"HTML_x0020_File_x0020_Type",objectType:"Text"},ows__SourceUrl:{mappedName:"_SourceUrl",objectType:"Text"},ows__SharedFileIndex:{mappedName:"_SharedFileIndex",objectType:"Text"},ows__EditMenuTableStart:{mappedName:"_EditMenuTableStart",objectType:"Computed"},ows__EditMenuTableEnd:{mappedName:"_EditMenuTableEnd",objectType:"Computed"},ows_LinkFilenameNoMenu:{mappedName:"LinkFilenameNoMenu",objectType:"Computed"},ows_LinkFilename:{mappedName:"LinkFilename",objectType:"Computed"},ows_DocIcon:{mappedName:"DocIcon",objectType:"Computed"},ows_ServerUrl:{mappedName:"ServerUrl",objectType:"Computed"},ows_EncodedAbsUrl:{mappedName:"EncodedAbsUrl",objectType:"Computed"},ows_BaseName:{mappedName:"BaseName",objectType:"Computed"},ows_FileSizeDisplay:{mappedName:"FileSizeDisplay",objectType:"Computed"},ows_MetaInfo:{mappedName:"MetaInfo",objectType:"Lookup"},ows__Level:{mappedName:"_Level",objectType:"Integer"},ows__IsCurrentVersion:{mappedName:"_IsCurrentVersion",objectType:"Boolean"},ows_SelectTitle:{mappedName:"SelectTitle",objectType:"Computed"},ows_SelectFilename:{mappedName:"SelectFilename",objectType:"Computed"},ows_Edit:{mappedName:"Edit",objectType:"Computed"},ows_owshiddenversion:{mappedName:"owshiddenversion",objectType:"Integer"},ows__UIVersion:{mappedName:"_UIVersion",objectType:"Integer"},ows__UIVersionString:{mappedName:"_UIVersionString",objectType:"Text"},ows_InstanceID:{mappedName:"InstanceID",objectType:"Integer"},ows_Order:{mappedName:"Order",objectType:"Number"},ows_GUID:{mappedName:"GUID",objectType:"Guid"},ows_WorkflowVersion:{mappedName:"WorkflowVersion",objectType:"Integer"},ows_WorkflowInstanceID:{mappedName:"WorkflowInstanceID",objectType:"Guid"},ows_ParentVersionString:{mappedName:"ParentVersionString",objectType:"Lookup"},ows_ParentLeafName:{mappedName:"ParentLeafName",objectType:"Lookup"},ows_Title:{mappedName:"Title",objectType:"Text"},ows_TemplateUrl:{mappedName:"TemplateUrl",objectType:"Text"},ows_xd_ProgID:{mappedName:"xd_ProgID",objectType:"Text"},ows_xd_Signature:{mappedName:"xd_Signature",objectType:"Boolean"},ows_Combine:{mappedName:"Combine",objectType:"Computed"},ows_RepairDocument:{mappedName:"RepairDocument",objectType:"Computed"}}}])}(angular),function(e){"use strict";e.module("angular.sp.list").factory("spFieldTypes",[function(){return{Invalid:0,Integer:1,Text:2,Note:3,DateTime:4,Counter:5,Choice:6,Lookup:7,Boolean:8,Number:9,Currency:10,URL:11,Computed:12,Threading:13,Guid:14,MultiChoice:15,GridChoice:16,Calculated:17,File:18,Attachments:19,User:20,Recurrence:21,CrossProjectLink:22,ModStat:23,Error:24,ContentTypeID:25,PageSeparator:26,ThreadIndex:27,WorkflowStatus:28,AllDayEvent:29,WorkflowEventType:30,Geolocation:null,OutcomeChoice:null,MaxItems:31}}])}(angular),function(e){"use strict";e.module("angular.sp.list").factory("spListItem",["modelBuilderService","restQueryBuilderService",function(e,t){function o(o,a,p,i){this.siteUrl=o,this.listName=a,this.viewFields=p,this.spServicesJsonMapping=i,this.getListItemType=function(){return"SP.Data."+this.listName.charAt(0).toUpperCase()+this.listName.split(" ").join("").slice(1)+"ListItem"},this.getSelectFields=function(e){return t.getSelectFields(this.spServicesJsonMapping,e)},this.getExpandFields=function(e){return t.getExpandFields(this.spServicesJsonMapping,e)},this.buildFromJson=function(t,o){return e.buildFromRestResponse(t,o,this.spServicesJsonMapping)},this.buildFromXml=function(t,o){return e.buildFromCamlResponse(t,o,this.spServicesJsonMapping)},this.buildListItem=function(t){return e.convertToSharePointListItem(t,this.spServicesJsonMapping)},this.build=function(e,t){return $.isXMLDoc(t)?this.buildFromXml(e,t):this.buildFromJson(e,t)}}return o}])}(angular),function(e){"use strict";e.module("angular.sp.list").factory("spListService",["$http","$q","_","RequestDigestIntervalService","RequestDigestCacheService","spFieldTypes","spBuiltInFieldNames",function(t,o,a,p,i,s,n){function r(o){this.spListItem=o,p.start(o.prototype.siteUrl),this.getByFilter=function(t,o){var a={$filter:t};return o=e.extend({},o,a),this.executeRestQuery(o)},this.getByFilters=this.getByFilter,this.get=function(e){return this.executeRestQuery(e)},this.getById=function(e){return this.getByArrayOfIds([e])},this.getByArrayOfIds=function(e){var t=[];a.each(e,function(e){t.push("<Value Type='Text'>"+e+"</Value>")});var o="<Query><Where><In><FieldRef Name='ID'/><Values>"+t.join("")+"</Values></In></Where></Query>";return this.executeCamlQuery(o)},this.provisionList=function(){var p={accept:"application/json;odata=verbose","X-RequestDigest":i.get(o.prototype.siteUrl),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"POST"},r={__metadata:{type:"SP.List"},AllowContentTypes:!0,BaseTemplate:100,ContentTypesEnabled:!0,Description:"",Title:o.prototype.listName};r=e.extend({},item,r);var c=o.prototype.siteUrl+"/_api/web/lists",d=JSON.stringify(r);return t({method:"POST",url:c,contentType:"application/json;odata=verbose",data:d,headers:p}).then(function(e){a.each(o.prototype.spServicesJsonMapping,function(e,t){n[t]||svc.provisionField(e.mappedName,s[e.objectType])})})},this.provisionField=function(a,p){var s={accept:"application/json;odata=verbose","X-RequestDigest":i.get(o.prototype.siteUrl),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"POST"},n={__metadata:{type:"SP.Field"},Title:a,FieldTypeKind:p};n=e.extend({},item,n);var r=o.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+o.prototype.listName+"')/Fields",c=JSON.stringify(n);return t({method:"POST",url:r,contentType:"application/json;odata=verbose",data:c,headers:s}).then(function(e){return e})},this.create=function(a){a=new o(a);var p={accept:"application/json;odata=verbose","X-RequestDigest":i.get(o.prototype.siteUrl),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"POST"},s=o.prototype.getListItemType(),n={__metadata:{type:s}};n=e.extend({},a,n);var r=o.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+o.prototype.listName+"')/Items",c=JSON.stringify(n);return t({method:"POST",url:r,contentType:"application/json;odata=verbose",data:c,headers:p}).then(function(e){return e.data.d})},this.update=function(a){a=new o(a);var p={accept:"application/json;odata=verbose","X-RequestDigest":i.get(o.prototype.siteUrl),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"MERGE"},s=o.prototype.getListItemType(),n={__metadata:{type:s}};n=e.extend({},a,n);var r=o.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+o.prototype.listName+"')/Items("+a.Id+")",c=JSON.stringify(n);return t({method:"POST",url:r,contentType:"application/json;odata=verbose",data:c,headers:p})},this.remove=function(a){a=new o(a);var p={accept:"application/json;odata=verbose","X-RequestDigest":i.get(o.prototype.siteUrl),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"DELETE"},s=o.prototype.getListItemType(),n={__metadata:{type:s}};n=e.extend({},a,n);var r=o.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+o.prototype.listName+"')/Items("+a.Id+")",c=JSON.stringify(n);return t({method:"POST",url:r,contentType:"application/json;odata=verbose",data:c,headers:p})},this.getCount=function(a){var p=o.prototype.siteUrl+"/_vti_bin/listdata.svc/"+o.prototype.listName+"/$count";return t({method:"GET",url:p,headers:{accept:"application/json;odata=verbose","content-Type":"application/json;odata=verbose"},params:{$filter:a}}).then(function(t){var o=0;try{e.isFinite(t.data)&&(o=t.data)}catch(e){}return o})},this.executeCamlQuery=function(e){var a=o.prototype.siteUrl+"/_vti_bin/Lists.asmx";return t({method:"POST",url:a,headers:{"Content-Type":"text/xml;charset='utf-8'",Accept:"application/json",SOAPAction:"http://schemas.microsoft.com/sharepoint/soap/GetListItems"},data:'<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+o.prototype.listName+"</listName><query>"+e+"</query></GetListItems></soap:Body></soap:Envelope>"}).then(function(e){var t=e.data.body||e.data,a=$.parseXML(t);return $(a).SPFilterNode("z:row").SPXmlToJson({mapping:o.prototype.spServicesJsonMapping,includeAllAttrs:!1})})},this.executeCamlQueryViaRest=function(e){return t({url:o.prototype.siteUrl+"/_api/Web/lists/getbytitle('"+o.prototype.listName+"')/getitems",method:"POST",headers:{Accept:"application/json; odata=verbose","Content-Type":"application/json; odata=verbose","X-RequestDigest":i.get(o.prototype.siteUrl)},data:{query:{__metadata:{type:"SP.CamlQuery"},ViewXml:"<View>"+e+"</View>"}}}).then(function(e){var t=[];return e.data.d&&e.data.d.results&&a.each(e.data.d.results,function(e,a){t.push(o.prototype.buildFromJson(o,e))}),t})},this.executeRestQuery=function(p){var s=o.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+o.prototype.listName+"')/Items",n=e.extend({},p);return t({method:"GET",url:s,headers:{accept:"application/json;odata=verbose","content-Type":"application/json;odata=verbose","X-RequestDigest":i.get(o.prototype.siteUrl)},params:{$select:n.$select,$filter:n.$filter,$skip:n.$skip,$top:n.$top,$expand:n.$expand,$orderby:n.$orderby}}).then(function(e){var t=[];return e.data.d&&e.data.d.results&&a.each(e.data.d.results,function(e,a){t.push(o.prototype.buildFromJson(o,e))}),t})}}return r}])}(angular);