!function(){"use strict";angular.module("angular.sp.list",[])}(),function(t){"use strict";t.module("angular.sp.list").factory("modelBuilderService",[function(){function e(t,e,i){var s={};return Object.keys(e).forEach(function(t,o){var n=i["ows_"+t];e[t]&&n&&("MultiChoice"==n.objectType||"LookupMulti"==n.objectType||"UserMulti"==n.objectType?e[t].results?s[n.mappedName]=e[t].results:"MultiChoice"==n.objectType?s[n.mappedName]=_.filter(e[t].split(";#"),function(t){return""!==t}):s[n.mappedName]=e[t]:s[n.mappedName]=e[t])}),new t(s,"rest")}function i(t,e,i){return new t($(e).SPXmlToJson({mapping:i,includeAllAttrs:!1,removeOws:!0}),"caml")}function s(e,i){var s=t.copy(e);return Object.keys(s).forEach(function(t,e){var o=_.findWhere(i,{mappedName:t});if(o&&!o.objectFactory){var n=_.findKey(i,o);n=n.substring(4,n.length),s[n]=s[t]}delete s[t]}),s}return{buildFromRestResponse:e,buildFromCamlResponse:i,convertToSharePointListItem:s}}])}(angular),function(t){"use strict";t.module("angular.sp.list").factory("restQueryBuilderService",[function(){function t(t,e){var i=[];return Object.keys(t).forEach(function(s,o){var n=t[s],r=s.replace("ows_","");if("Lookup"==n.objectType||"LookupMulti"==n.objectType){if(e){var a=[];n.objectFactory&&n.objectFactory.prototype.getSelectFields&&(a=n.objectFactory.prototype.getSelectFields(!1).split(","),_.each(a,function(t,e){a[e]=r+"/"+t})),i=i.concat(a)}}else i.push(r)}),i.join(",")}function e(e,i){var s=[],o=t(e,!0).split(",");return o=_.filter(o,function(t,e){return-1!=t.indexOf("/")}),_.each(o,function(t,e){t=t.split("/"),t.pop(),t=t.join("/"),-1==s.indexOf(t)&&s.push(t)}),s.join(",")}return{getSelectFields:t,getExpandFields:e}}])}(angular),function(t){"use strict";t.module("angular.sp.list").factory("spListItem",["modelBuilderService","restQueryBuilderService",function(t,e){function i(i,s,o,n){this.siteUrl=i,this.listName=s,this.viewFields=o,this.spServicesJsonMapping=n,this.getListItemType=function(){return"SP.Data."+this.listName.charAt(0).toUpperCase()+this.listName.split(" ").join("").slice(1)+"ListItem"},this.getSelectFields=function(t){return e.getSelectFields(this.spServicesJsonMapping,t)},this.getExpandFields=function(t){return e.getExpandFields(this.spServicesJsonMapping,t)},this.buildFromJson=function(e,i){return t.buildFromRestResponse(e,i,this.spServicesJsonMapping)},this.buildFromXml=function(e,i){return t.buildFromCamlResponse(e,i,this.spServicesJsonMapping)},this.buildListItem=function(e){return t.convertToSharePointListItem(e,this.spServicesJsonMapping)},this.build=function(t,e){return $.isXMLDoc(e)?this.buildFromXml(t,e):this.buildFromJson(t,e)}}return i}])}(angular),function(t){"use strict";t.module("angular.sp.list").factory("spListService",["$http","$q","_",function(e,i,s){function o(i){this.spListItem=i,this.getByFilter=function(t,e){return this.executeRestQuery(null,e,t,null)},this.getByFilters=this.getByFilter,this.get=function(){return this.executeRestQuery(null,null,null,null)},this.getById=function(t){return this.getByArrayOfIds([t])},this.getByArrayOfIds=function(t){var e=[];s.each(t,function(t){e.push("<Value Type='Text'>"+t+"</Value>")});var i="<Query><Where><In><FieldRef Name='ID'/><Values>"+e.join("")+"</Values></In></Where></Query>";return this.executeCamlQuery(i)},this.create=function(s){s=new i(s);var o={accept:"application/json;odata=verbose","X-RequestDigest":window.__REQUESTDIGEST[i.prototype.siteUrl],"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"POST"},n=i.prototype.getListItemType(),r={__metadata:{type:n}};r=t.extend({},s,r);var a=i.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+i.prototype.listName+"')/Items",p=JSON.stringify(r);return e({method:"POST",url:a,contentType:"application/json;odata=verbose",data:p,headers:o}).then(function(t){return t.data.d})},this.update=function(s){s=new i(s);var o={accept:"application/json;odata=verbose","X-RequestDigest":window.__REQUESTDIGEST[i.prototype.siteUrl],"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"MERGE"},n=i.prototype.getListItemType(),r={__metadata:{type:n}};r=t.extend({},s,r);var a=i.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+i.prototype.listName+"')/Items("+s.Id+")",p=JSON.stringify(r);return e({method:"POST",url:a,contentType:"application/json;odata=verbose",data:p,headers:o})},this.remove=function(s){s=new i(s);var o={accept:"application/json;odata=verbose","X-RequestDigest":window.__REQUESTDIGEST[i.prototype.siteUrl],"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"DELETE"},n=i.prototype.getListItemType(),r={__metadata:{type:n}};r=t.extend({},s,r);var a=i.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+i.prototype.listName+"')/Items("+s.Id+")",p=JSON.stringify(r);return e({method:"POST",url:a,contentType:"application/json;odata=verbose",data:p,headers:o})},this.executeCamlQuery=function(t){var s=i.prototype.siteUrl+"/_vti_bin/Lists.asmx";return e({method:"POST",url:s,headers:{"Content-Type":"text/xml;charset='utf-8'",Accept:"application/json",SOAPAction:"http://schemas.microsoft.com/sharepoint/soap/GetListItems"},data:'<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+i.prototype.listName+"</listName><query>"+t+"</query></GetListItems></soap:Body></soap:Envelope>"}).then(function(t){var e=t.data.body||t.data,s=$.parseXML(e);return $(s).SPFilterNode("z:row").SPXmlToJson({mapping:i.prototype.spServicesJsonMapping,includeAllAttrs:!1})})},this.executeRestQuery=function(t,o,n,r){var a=i.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+i.prototype.listName+"')/Items";return e({method:"GET",url:a,headers:{accept:"application/json;odata=verbose","content-Type":"application/json;odata=verbose"},params:{$top:t||1e5,$select:o,$filter:n,$expand:r}}).then(function(t){var e=[];return t.data.d&&t.data.d.results&&s.each(t.data.d.results,function(t,s){e.push(i.prototype.buildFromJson(i,t))}),e})}}return o}])}(angular);