!function(){"use strict";angular.module("angular.sp.list",[])}(),function(t){"use strict";t.module("angular.sp.list").factory("modelBuilderService",[function(){function e(t,e,s){var i={};return Object.keys(e).forEach(function(t,o){var n=s["ows_"+t];e[t]&&n&&("MultiChoice"==n.objectType||"LookupMulti"==n.objectType||"UserMulti"==n.objectType?e[t].results?i[n.mappedName]=e[t].results:"MultiChoice"==n.objectType?i[n.mappedName]=_.filter(e[t].split(";#"),function(t){return""!==t}):i[n.mappedName]=e[t]:i[n.mappedName]=e[t])}),new t(i,"rest")}function s(t,e,s){return new t($(e).SPXmlToJson({mapping:s,includeAllAttrs:!1,removeOws:!0}),"caml")}function i(e,s){var i=t.copy(e);return Object.keys(i).forEach(function(t,e){var o=_.findWhere(s,{mappedName:t});if(o&&!o.objectFactory){var n=_.findKey(s,o);n=n.substring(4,n.length),i[n]=i[t]}delete i[t]}),i}return{buildFromRestResponse:e,buildFromCamlResponse:s,convertToSharePointListItem:i}}])}(angular),function(t){"use strict";t.module("angular.sp.list").factory("restQueryBuilderService",[function(){function t(t,e){var s=[];return Object.keys(t).forEach(function(i,o){var n=t[i],r=i.replace("ows_","");if("Lookup"==n.objectType||"LookupMulti"==n.objectType){if(e){var a=[];n.objectFactory&&n.objectFactory.prototype.getSelectFields&&(a=n.objectFactory.prototype.getSelectFields(!1).split(","),_.each(a,function(t,e){a[e]=r+"/"+t})),s=s.concat(a)}}else s.push(r)}),s.join(",")}function e(e,s){var i=[],o=t(e,!0).split(",");return o=_.filter(o,function(t,e){return-1!=t.indexOf("/")}),_.each(o,function(t,e){t=t.split("/"),t.pop(),t=t.join("/"),-1==i.indexOf(t)&&i.push(t)}),i.join(",")}return{getSelectFields:t,getExpandFields:e}}])}(angular),function(t){"use strict";t.module("angular.sp.list").factory("spListItem",["modelBuilderService","restQueryBuilderService",function(t,e){function s(s,i,o,n){this.siteUrl=s,this.listName=i,this.viewFields=o,this.spServicesJsonMapping=n,this.getListItemType=function(){return"SP.Data."+this.listName.charAt(0).toUpperCase()+this.listName.split(" ").join("").slice(1)+"ListItem"},this.getSelectFields=function(t){return e.getSelectFields(this.spServicesJsonMapping,t)},this.getExpandFields=function(t){return e.getExpandFields(this.spServicesJsonMapping,t)},this.buildFromJson=function(e,s){return t.buildFromRestResponse(e,s,this.spServicesJsonMapping)},this.buildFromXml=function(e,s){return t.buildFromCamlResponse(e,s,this.spServicesJsonMapping)},this.buildListItem=function(e){return t.convertToSharePointListItem(e,this.spServicesJsonMapping)},this.build=function(t,e){return $.isXMLDoc(e)?this.buildFromXml(t,e):this.buildFromJson(t,e)}}return s}])}(angular),function(t){"use strict";t.module("angular.sp.list").factory("spListService",["$http","$q","_",function(e,s,i){function o(s){this.spListItem=s,this.getByFilter=function(t,e){return this.executeRestQuery(null,e,t,null)},this.getByFilters=this.getByFilter,this.get=function(){return this.executeRestQuery(null,null,null,null)},this.getById=function(t){return this.getByArrayOfIds([t])},this.getByArrayOfIds=function(t){var e=[];i.each(t,function(t){e.push("<Value Type='Text'>"+t+"</Value>")});var s="<Query><Where><In><FieldRef Name='ID'/><Values>"+e.join("")+"</Values></In></Where></Query>";return this.executeCamlQuery(s)},this.create=function(i){i=new s(i);var o={accept:"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val(),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"POST"},n=s.prototype.getListItemType(),r={__metadata:{type:n}};r=t.extend({},i,r);var a=s.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+s.prototype.listName+"')/Items",p=JSON.stringify(r);return e({method:"POST",url:a,contentType:"application/json;odata=verbose",data:p,headers:o}).then(function(t){return t.data.d})},this.update=function(i){i=new s(i);var o={accept:"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val(),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"MERGE"},n=s.prototype.getListItemType(),r={__metadata:{type:n}};r=t.extend({},i,r);var a=s.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+s.prototype.listName+"')/Items("+i.Id+")",p=JSON.stringify(r);return e({method:"POST",url:a,contentType:"application/json;odata=verbose",data:p,headers:o})},this.remove=function(i){i=new s(i);var o={accept:"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val(),"content-type":"application/json;odata=verbose","If-Match":"*","X-HTTP-Method":"DELETE"},n=s.prototype.getListItemType(),r={__metadata:{type:n}};r=t.extend({},i,r);var a=s.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+s.prototype.listName+"')/Items("+i.Id+")",p=JSON.stringify(r);return e({method:"POST",url:a,contentType:"application/json;odata=verbose",data:p,headers:o})},this.executeCamlQuery=function(t){var i=s.prototype.siteUrl+"/_vti_bin/Lists.asmx";return e({method:"POST",url:i,headers:{"Content-Type":"text/xml;charset='utf-8'",Accept:"application/json",SOAPAction:"http://schemas.microsoft.com/sharepoint/soap/GetListItems"},data:'<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetListItems xmlns="http://schemas.microsoft.com/sharepoint/soap/"><listName>'+s.prototype.listName+"</listName><query>"+t+"</query></GetListItems></soap:Body></soap:Envelope>"}).then(function(t){var e=t.data.body||t.data,i=$.parseXML(e);return $(i).SPFilterNode("z:row").SPXmlToJson({mapping:s.prototype.spServicesJsonMapping,includeAllAttrs:!1})})},this.executeRestQuery=function(t,o,n,r){var a=s.prototype.siteUrl+"/_api/web/lists/GetByTitle('"+s.prototype.listName+"')/Items";return e({method:"GET",url:a,headers:{accept:"application/json;odata=verbose","content-Type":"application/json;odata=verbose"},params:{$top:t||1e5,$select:o,$filter:n,$expand:r}}).then(function(t){var e=[];return t.data.d&&t.data.d.results&&i.each(t.data.d.results,function(t,i){e.push(s.prototype.buildFromJson(s,t))}),e})}}return o}])}(angular);